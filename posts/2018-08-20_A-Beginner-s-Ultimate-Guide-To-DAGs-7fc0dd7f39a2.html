<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>A Beginner’s Ultimate Guide To DAGs</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">A Beginner’s Ultimate Guide To DAGs</h1>
</header>
<section data-field="subtitle" class="p-summary">
What Are DAGs and How do they Work?
</section>
<section data-field="body" class="e-content">
<section name="f968" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="5f37" id="5f37" class="graf graf--h3 graf--leading graf--title">A Beginner’s Ultimate Guide To DAGs</h3><h4 name="798d" id="798d" class="graf graf--h4 graf-after--h3 graf--subtitle">What Are DAGs and How do they Work?</h4></div><div class="section-inner sectionLayout--fullWidth"><figure name="12d5" id="12d5" class="graf graf--figure graf--layoutFillWidth graf-after--h4"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 56.3%;"></div><img class="graf-image" data-image-id="0*jfWZFflYM18tZKhL.jpg" data-width="1440" data-height="810" src="https://cdn-images-1.medium.com/max/2560/0*jfWZFflYM18tZKhL.jpg"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="1e52" id="1e52" class="graf graf--p graf-after--figure">The purpose of this post is to clearly understand the idea behind the DAGs.</p><p name="86eb" id="86eb" class="graf graf--p graf-after--p">The best way to fully understand it to a deep level is to learning by reasoning that why are the things are the way they are. So, we are going to start with a really basic DAG and then try to build a robust and secure DAG network by logically introducing more complex things in a way that makes sense.</p><p name="ba47" id="ba47" class="graf graf--p graf-after--p">For this tutorial we are going to see how the tangle of IOTA works.</p><h3 name="b33f" id="b33f" class="graf graf--h3 graf-after--p"><strong class="markup--strong markup--h3-strong"><em class="markup--em markup--h3-em">Directed graph</em></strong></h3><p name="952d" id="952d" class="graf graf--p graf-after--h3">To understand the tangle, we need to learn about what computer scientists call a <a href="https://en.wikipedia.org/wiki/Directed_graph" data-href="https://en.wikipedia.org/wiki/Directed_graph" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">directed graph</em></strong></a>. A directed graph is a collection of <em class="markup--em markup--p-em">vertices </em>(squares), which are connected to each other by <em class="markup--em markup--p-em">edges</em> (arrows). This is an example of a directed graph:</p><figure name="0ca6" id="0ca6" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 216px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 30.9%;"></div><img class="graf-image" data-image-id="0*ugPaad_14ESxwsPi." data-width="1139" data-height="352" src="https://cdn-images-1.medium.com/max/800/0*ugPaad_14ESxwsPi."></div><figcaption class="imageCaption">a simple DAG</figcaption></figure><p name="7459" id="7459" class="graf graf--p graf-after--figure">The <strong class="markup--strong markup--p-strong">Tangle</strong>, which is the data structure behind IOTA, is a particular kind of directed graph, which holds <em class="markup--em markup--p-em">transactions</em>. Each transaction is represented as a vertex in the graph. When a new transaction joins the tangle, it chooses two previous transactions to <em class="markup--em markup--p-em">approve</em>, adding two new edges to the graph. In the example above, transaction number 5 approves transactions number 2 and 3. Transactions are more or less what you would expect, information of the form “person A gave person B ten IOTAs”. At this stage we won’t worry too much about what we mean by approving a transaction, as we’ll get into that later.</p><p name="47d8" id="47d8" class="graf graf--p graf-after--p">We call unapproved transactions <em class="markup--em markup--p-em">tips</em>. In the example, transaction number 6 is a tip, because no one approved it yet. Each incoming transaction needs to choose two tips to approve (there is always at least one!). The strategy for choosing which two tips to approve is very important, and is the key to IOTA’s unique technology. However, to make our lives easier, we’ll start with the simplest strategy: choosing randomly between all available tips. Each incoming transaction looks at all the currently unapproved transactions, and simply chooses two at random.</p><p name="60b0" id="60b0" class="graf graf--p graf-after--p">To see what the tangle looks like when everyone uses this random selection strategy (technically called “uniform random tip selection”), you can play with this <a href="https://public-rdsdavdrpd.now.sh/" data-href="https://public-rdsdavdrpd.now.sh/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">visual simulation</strong></a> of it. This simulation generates random tangles, with the very first transaction (called the <em class="markup--em markup--p-em">genesis</em>) on the left and the most recent transactions on the right. The tips are marked with a gray square. When you put your mouse over a transaction, all the transactions approved by it are highlighted in red, and all those which approve it turn blue.</p><figure name="392e" id="392e" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 358px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 51.2%;"></div><a href="https://public-rdsdavdrpd.now.sh/" data-href="https://public-rdsdavdrpd.now.sh/" class="graf-imageAnchor" data-action="image-link" data-action-observe-only="true"rel="noopener"target="_blank"><img class="graf-image" data-image-id="1*H8xoyZN5ESR1_FWa1xijEQ.gif" data-width="1166" data-height="597" src="https://cdn-images-1.medium.com/max/800/1*H8xoyZN5ESR1_FWa1xijEQ.gif"></a></div></figure><h3 name="2244" id="2244" class="graf graf--h3 graf-after--figure">Transaction Rates and Network Latency</h3><p name="ded5" id="ded5" class="graf graf--p graf-after--h3">In previous simulation, you may have noticed that transactions are not evenly spread out across time, but some periods are “busier” than others. This randomness, which makes the model more realistic, is achieved by using a <a href="https://en.wikipedia.org/wiki/Poisson_point_process" data-href="https://en.wikipedia.org/wiki/Poisson_point_process" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">Poisson point process</strong></a> to model how transactions arrive. This model is very common for analyzing how many customers walk into a store in a given time period, or how many phone calls are made to a call center. We can see this behavior in example tangle below. Transactions 4, 5, and 6 arrived almost simultaneously, and after transaction 6 there was a long pause.</p><figure name="b97a" id="b97a" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 271px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 38.7%;"></div><img class="graf-image" data-image-id="0*Ky8YrqUebNcgDFmk." data-width="1174" data-height="454" src="https://cdn-images-1.medium.com/max/800/0*Ky8YrqUebNcgDFmk."></div></figure><p name="472d" id="472d" class="graf graf--p graf-after--figure">For our purposes, we only need to know one thing about this Poisson point process: on average, the rate of incoming transactions is constant, and is set by a number we call λ. As an example, if we set λ=2, and the number of transactions to be 100, the total simulation time will be about 50 time units. <a href="https://public-xnmzdqumwy.now.sh/" data-href="https://public-xnmzdqumwy.now.sh/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Try it out</a>!</p><p name="68f5" id="68f5" class="graf graf--p graf-after--p">One more interesting thing to point out, before moving on: if we set λ to a very small amount (say 0.1), we get a “chain”. A chain is a tangle where transactions only approve one previous transaction, instead of two. This happens because transactions are coming in so slowly that at any given time there is only a single tip to approve. This is what actually happens in a blockchain. Thus DAGs are basically a generalized form of the blockchain. In the other extreme, with huge λ, all of the transactions arrive so fast that the only tip they see is the genesis. This is just a limitation of the simulation: with large λ and a fixed number of transactions, we are simulating a very short time period.</p><figure name="5c14" id="5c14" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 225px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 32.1%;"></div><img class="graf-image" data-image-id="0*9nJP7-qMCHm8jXLm." data-width="1172" data-height="376" src="https://cdn-images-1.medium.com/max/800/0*9nJP7-qMCHm8jXLm."></div><figcaption class="imageCaption"><em class="markup--em markup--figure-em">Very small λ produces a chain (Blockchain like Structure)</em></figcaption></figure><figure name="d7e4" id="d7e4" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 295px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 42.199999999999996%;"></div><img class="graf-image" data-image-id="0*mtdodISa6aBjqyR1." data-width="1154" data-height="487" src="https://cdn-images-1.medium.com/max/800/0*mtdodISa6aBjqyR1."></div><figcaption class="imageCaption"><em class="markup--em markup--figure-em">Very large λ: only the genesis is visible</em></figcaption></figure><p name="4ace" id="4ace" class="graf graf--p graf-after--figure">So what do we mean by the transaction not “seeing” a previous one? In the model, we make each transaction invisible for a certain period after it arrives. We mark this delay period with the letter <em class="markup--em markup--p-em">h</em>. This delay represents the time it takes for the transaction to be prepared and propagate through the network. In our simulation, we always set <em class="markup--em markup--p-em">h=1</em>. This means we can only approve transactions that are at least one time unit in the past. This delay is not just a minor detail that was put in for extra realism, but a fundamental property of the tangle, without which we will always get a very boring chain. It also brings the tangle closer to the real world, where it takes some time for people to tell each other about new transactions.</p><h3 name="0263" id="0263" class="graf graf--h3 graf-after--p"><em class="markup--em markup--h3-em">Random Walk</em></h3><p name="c04f" id="c04f" class="graf graf--p graf-after--h3">Finally, it’s time to talk about a more advanced tip selection algorithm: the <em class="markup--em markup--p-em">unweighted random walk</em>. Using this algorithm, we put a <em class="markup--em markup--p-em">walker</em> on the genesis transaction, and have it start “walking” towards the tips. On each step it jumps to one of the transactions which directly approves the one we are currently on. We choose which transaction to jump to with equal probability, which is where the term <em class="markup--em markup--p-em">unweighted</em> comes from. Here is a <a href="https://public-xnmzdqumwy.now.sh/" data-href="https://public-xnmzdqumwy.now.sh/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">simulation</strong></a><strong class="markup--strong markup--p-strong"> </strong>that shows how this happens.</p><figure name="f5c8" id="f5c8" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 360px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 51.4%;"></div><a href="https://public-xnmzdqumwy.now.sh/" data-href="https://public-xnmzdqumwy.now.sh/" class="graf-imageAnchor" data-action="image-link" data-action-observe-only="true"rel="noopener"target="_blank"><img class="graf-image" data-image-id="1*1vdLkM4u7juZDTIq2CMslQ.gif" data-width="1162" data-height="597" src="https://cdn-images-1.medium.com/max/800/1*1vdLkM4u7juZDTIq2CMslQ.gif"></a></div><figcaption class="imageCaption">Unweighted Random Walk</figcaption></figure><p name="931a" id="931a" class="graf graf--p graf-after--figure">You can see the path the walker follows is marked in red, and at each junction the different possible paths are marked in blue. Very recent transactions, which are “invisible” to the current random walk, are shown as transparent.</p><h3 name="ce56" id="ce56" class="graf graf--h3 graf-after--p">Weighted Random Walk and C<em class="markup--em markup--h3-em">umulative Weight</em></h3><p name="7c3b" id="7c3b" class="graf graf--p graf-after--h3">Let us begin with some motivation for studying it. One of the things we want our tip selection algorithm to do is avoid <em class="markup--em markup--p-em">lazy tips</em>. A lazy tip is one that approves old transactions rather than recent ones. It is lazy because it does not bother keeping up to date with the newest state of the tangle, and only broadcasts its own transactions based on old data. This does not help the network, since no new transactions are confirmed.</p><figure name="c6f9" id="c6f9" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 317px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 45.300000000000004%;"></div><img class="graf-image" data-image-id="0*-BUE4CNQNSl8nNby." data-width="1190" data-height="539" src="https://cdn-images-1.medium.com/max/800/0*-BUE4CNQNSl8nNby."></div><figcaption class="imageCaption">Unweighted Random Walk</figcaption></figure><p name="49e4" id="49e4" class="graf graf--p graf-after--figure">In the example above, transaction 14 is a lazy tip, which approves some very old transactions. If we use the uniform random tip selection algorithm, transaction 14 is just as likely to get approved as any other, so it is not being penalized at all. Using the unweighted walk, this bad behavior is even encouraged, at least in the previous simulation.</p><p name="5fb5" id="5fb5" class="graf graf--p graf-after--p">How can we deal with this problem? One thing we cannot do is force participants to only approve recent transactions, since that would clash with the idea of decentralization. Transactions can approve whomever they please. We also don’t have an reliable way of telling exactly when each transaction came in, so we cannot enforce such a rule. Our solution is to construct our system with built-in incentives against such behavior, so that lazy tips will be unlikely to get approved by anyone.</p><p name="8502" id="8502" class="graf graf--p graf-after--p">Our strategy will be to <em class="markup--em markup--p-em">bias</em> our random walk, so we are less likely to choose lazy tips. We will use the term <em class="markup--em markup--p-em">cumulative weight</em> to denote how important a transaction is. We are more likely to walk towards a heavy transaction than a light one. The definition of cumulative weight is very simple: we count how many approvers a transaction has, and add one. We count both direct and indirect approvers. In the example below, transaction 3 has a cumulative weight of five, because it has four transactions which approve it (5 directly; 7, 8, and 10 indirectly).</p><figure name="ceb4" id="ceb4" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 280px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 40%;"></div><img class="graf-image" data-image-id="0*pIhgmSHYjYwEA-St." data-width="1115" data-height="446" src="https://cdn-images-1.medium.com/max/800/0*pIhgmSHYjYwEA-St."></div><figcaption class="imageCaption">Weighted Random Walk with <em class="markup--em markup--figure-em">cumulative weights</em></figcaption></figure><p name="4e64" id="4e64" class="graf graf--p graf-after--figure">Why does this work? Let’s have a look at another lazy tip situation. In the example below, transaction 16 is a lazy tip. In order for 16 to get approved, the random walker must reach transaction 7, and then choose transaction 16 over transaction 9. But this is unlikely to happen, because transaction 16 has a cumulative weight of 1, and transaction 9 has a cumulative weight of 7! This is an effective way of discouraging lazy behavior.</p><figure name="1514" id="1514" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 311px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 44.4%;"></div><img class="graf-image" data-image-id="0*5hzv8meXLLWeKuGm." data-width="1157" data-height="514" src="https://cdn-images-1.medium.com/max/800/0*5hzv8meXLLWeKuGm."></div><figcaption class="imageCaption">Weighted Random Walk (Incentivizing non-lazy tips)</figcaption></figure><p name="8c1e" id="8c1e" class="graf graf--p graf-after--figure">At this point we might ask: do we need randomness at all? We can invent the <em class="markup--em markup--p-em">super-weighted random walk</em>, where at each junction we choose the heaviest transaction, with no probabilities involved. We will then get something like this:</p><figure name="c7b1" id="c7b1" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 271px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 38.800000000000004%;"></div><img class="graf-image" data-image-id="0*PqjubcCEQqN2FCwT." data-width="1174" data-height="455" src="https://cdn-images-1.medium.com/max/800/0*PqjubcCEQqN2FCwT."></div><figcaption class="imageCaption">The super-weighted walk. We always walk towards the heaviest transactions</figcaption></figure><p name="b8b8" id="b8b8" class="graf graf--p graf-after--figure">The gray squares are tips, with zero approvers. While it is normal to have some tips on the right end of the diagram, it is a problem to see so many of them spread out across the timeline. These tips are transactions that are <em class="markup--em markup--p-em">left behind</em>, and will never be approved. This is the down-side to biasing our walk too much: if we insist on choosing only the heaviest transaction at any given point, a large percentage of the tips will never get approved. We are left with only a central corridor of approved transactions, and forgotten tips on the sidelines.</p><p name="8003" id="8003" class="graf graf--p graf-after--p">We need a method to define how likely we are to walk towards any particular approver at a given junction. The exact formula we choose is not important, as long as we give some bias to heavier transactions, and have a parameter to control how strong this bias is. This introduces our new parameter <em class="markup--em markup--p-em">α</em>, which sets how important a transaction’s cumulative weight is. Its exact definition can be found in the IOTA’s <a href="https://iota.readme.io/docs/whitepaper" data-href="https://iota.readme.io/docs/whitepaper" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">white paper</a>, and if there is demand I might write a future post giving some more details on it.</p><figure name="ce68" id="ce68" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 255px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 36.4%;"></div><img class="graf-image" data-image-id="1*Le0N_rKh7NrR-7z9y9UTxg.png" data-width="1139" data-height="415" src="https://cdn-images-1.medium.com/max/800/1*Le0N_rKh7NrR-7z9y9UTxg.png"></div><figcaption class="imageCaption"><em class="markup--em markup--figure-em">The weighted random walk: each blue transaction shows its cumulative weight, and its probability of being chosen as the next step in the walk.</em></figcaption></figure><p name="a116" id="a116" class="graf graf--p graf-after--figure">If we set <em class="markup--em markup--p-em">α</em> to zero, we go back to the unweighted walk. If we set <em class="markup--em markup--p-em">α </em>to be very high, we get the super-weighted walk. In between, we can find a good balance between punishing lazy behavior and not leaving too many tips behind. Determining an ideal value for <em class="markup--em markup--p-em">α</em> is an important research topic in IOTA.</p><p name="a70b" id="a70b" class="graf graf--p graf-after--p">This method of setting a rule for deciding the probability of each step in a random walk is called a <a href="https://en.wikipedia.org/wiki/Markov_chain_Monte_Carlo" data-href="https://en.wikipedia.org/wiki/Markov_chain_Monte_Carlo" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Markov Chain Monte Carlo</em></strong></a> technique, or MCMC. In a Markov chain each step does not depend on the previous one, but follows from a rule that is decided in advance.</p><figure name="7587" id="7587" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 358px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 51.1%;"></div><a href="https://public-qnbiiqwyqj.now.sh/" data-href="https://public-qnbiiqwyqj.now.sh/" class="graf-imageAnchor" data-action="image-link" data-action-observe-only="true"rel="noopener"target="_blank"><img class="graf-image" data-image-id="0*ENA8_G-dPuAhB-ND." data-width="1162" data-height="594" src="https://cdn-images-1.medium.com/max/800/0*ENA8_G-dPuAhB-ND."></a></div></figure><p name="ceab" id="ceab" class="graf graf--p graf-after--figure">As always, we have a <a href="https://public-qnbiiqwyqj.now.sh/" data-href="https://public-qnbiiqwyqj.now.sh/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">simulation</strong></a><strong class="markup--strong markup--p-strong"> </strong>to demonstrate these new ideas. I recommend playing around with the values of <em class="markup--em markup--p-em">α </em>and λ, and seeing what kind of interesting tangles you can cook up.</p><h3 name="b9d2" id="b9d2" class="graf graf--h3 graf-after--p">Approvers, Balances and Double-spends</h3><p name="225a" id="225a" class="graf graf--p graf-after--h3">So far we talked about DAGs, random walks, and various tip selection mechanisms; this time we will talk about money. The time has come to explain what we mean when we say that transaction A <em class="markup--em markup--p-em">approves</em> transaction B.</p><p name="c8d3" id="c8d3" class="graf graf--p graf-after--p">As mentioned above, each transaction contains information of the form “Alice gave bob 10 IOTAs”. It is the approver’s job to make sure that Alice really <em class="markup--em markup--p-em">had </em>those 10 IOTAs to give in the first place.</p><p name="255d" id="255d" class="graf graf--p graf-after--p">You might wonder at this point: where did these IOTAs come from? The answer is that they were all created in the very first transaction in the tangle, called the <em class="markup--em markup--p-em">genesis</em> <em class="markup--em markup--p-em">transaction</em>. No additional IOTAs will ever be created. From the genesis the IOTAs were transferred to the accounts of the original investors in the project, in proportion to the amount they put in. Afterwards, they sold some of their IOTA to others, and a trading network was eventually established.</p><p name="6aa9" id="6aa9" class="graf graf--p graf-after--p">Coming back to Alice and Bob, let’s look at a simple example. The box represents a transaction. For convenience, we also write down the balances in Alice and Bob’s accounts before and after the transaction took place. We see that in the beginning Alice had 10i, which she gave to Bob, after which Bob has 10i and Alice has nothing.</p><figure name="0504" id="0504" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 304px; max-height: 174px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 57.199999999999996%;"></div><img class="graf-image" data-image-id="0*KTZmL34g8hs_mxRh." data-width="304" data-height="174" src="https://cdn-images-1.medium.com/max/800/0*KTZmL34g8hs_mxRh."></div><figcaption class="imageCaption">A Transaction</figcaption></figure><p name="37dd" id="37dd" class="graf graf--p graf-after--figure">Eventually someone, say Charlie, wants to make his own payment. He runs the tip selection algorithm, and it turns out he needs to approve Alice’s transaction. To do that, he must verify that Alice really had the 10i she spent. Charlie had better take this task seriously: if he approves a bad transaction, his own transaction will never be approved!</p><p name="5b1b" id="5b1b" class="graf graf--p graf-after--p">To be absolutely sure, Charlie has to list all the transactions approved directly and indirectly by Alice’s transaction, all the way back to the genesis. He ends up with a long list, which may look like this:</p><ol class="postList"><li name="28c6" id="28c6" class="graf graf--li graf-after--p">Genesis creates 15i</li><li name="9331" id="9331" class="graf graf--li graf-after--li">Genesis gives Bob 2i</li><li name="0d76" id="0d76" class="graf graf--li graf-after--li">Genesis gives Alice 8i</li><li name="d76b" id="d76b" class="graf graf--li graf-after--li">Genesis gives Charlie 5i</li><li name="12e8" id="12e8" class="graf graf--li graf-after--li">Charlie gives Donna 3i</li><li name="c721" id="c721" class="graf graf--li graf-after--li">Bob gives Alice 2i</li></ol><p name="1bca" id="1bca" class="graf graf--p graf-after--li">This is just one option of course; any list that ends up with 10i in Alice’s account and 0 in Bob’s is acceptable. Charlie also has to keep track of all the other accounts in the system, to make sure they do not go below zero: if any of the balances in the “before” or “after” sections are negative, his transaction is invalid.</p><p name="e2fd" id="e2fd" class="graf graf--p graf-after--p">Let’s have a look at at a case where Alice tries to give more IOTAs than she has:</p><figure name="0c97" id="0c97" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 304px; max-height: 176px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 57.9%;"></div><img class="graf-image" data-image-id="0*YmTT-yxnS6iavDYe." data-width="304" data-height="176" src="https://cdn-images-1.medium.com/max/800/0*YmTT-yxnS6iavDYe."></div></figure><p name="c8c4" id="c8c4" class="graf graf--p graf-after--figure">Alice paid Bob 100i even though she only had 10. Alice’s transaction, and any future transaction that approves it, are considered invalid by the network. Negative balances are not allowed.</p><p name="84b1" id="84b1" class="graf graf--p graf-after--p">The situation gets more interesting when we approve two transactions rather than one:</p><figure name="8eb0" id="8eb0" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 363px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 51.800000000000004%;"></div><img class="graf-image" data-image-id="0*hf8SqUxjoiA254er." data-width="737" data-height="382" src="https://cdn-images-1.medium.com/max/800/0*hf8SqUxjoiA254er."></div></figure><p name="4850" id="4850" class="graf graf--p graf-after--figure">Bob was correct in approving Alice’s transactions, because she had just enough money in her account to pay both without going below zero.</p><p name="28e7" id="28e7" class="graf graf--p graf-after--p">What would happen if the total is more than she has? This is shown below. In this case, Bob <em class="markup--em markup--p-em">cannot</em> approve both of Alice’s transactions, because they result in a negative balance for Alice. If Bob does this, he is breaking the rules of the IOTA protocol, and no one will approve his new transaction.</p><figure name="a111" id="a111" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 368px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 52.6%;"></div><img class="graf-image" data-image-id="0*_PX0hC-SVYdMgBDs." data-width="732" data-height="385" src="https://cdn-images-1.medium.com/max/800/0*_PX0hC-SVYdMgBDs."></div></figure><p name="e652" id="e652" class="graf graf--p graf-after--figure">This last situation is called a <a href="https://en.wikipedia.org/wiki/Double-spending" data-href="https://en.wikipedia.org/wiki/Double-spending" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">double spend</em></strong></a>, because Alice spent her money <em class="markup--em markup--p-em">twice</em>. Notice that she did not break the protocol, because she had enough money for each individual transaction. Maybe she did not even mean to double-spend, but sent her transaction twice by mistake. She did however create two <em class="markup--em markup--p-em">branches</em> in the tangle that cannot be reconciled. This creates a problem for honest users of IOTA: which branch should they approve?</p><p name="a5f1" id="a5f1" class="graf graf--p graf-after--p">The solution to this problem is once again the weighted walk we learned about last week. Eventually one of the branches will grow heavier than the other, and the lighter one will be abandoned. This also implies that a transaction cannot be considered to be confirmed immediately after it is issued, even if it has some approvers, since it might be part of a branch that will be abandoned eventually. In order to be sure your transaction is confirmed, you have to wait for its <em class="markup--em markup--p-em">confirmation confidence</em> to be high enough.</p><h3 name="79a2" id="79a2" class="graf graf--h3 graf-after--p">Consensus, Confirmation confidence and the Coordinator</h3><p name="7a84" id="7a84" class="graf graf--p graf-after--h3">We just mentioned the <em class="markup--em markup--p-em">double-spend</em> problem, which arises when Alice tries to spend her money more than once. Now, we will show how this problem is resolved in the Tangle, and how we decide which history is the valid one.</p><p name="a965" id="a965" class="graf graf--p graf-after--p">To illustrate the problem, we will examine the following double spend scenario:</p><figure name="3b54" id="3b54" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 370px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 52.900000000000006%;"></div><img class="graf-image" data-image-id="0*hu_bY4iSNNPWBpS1." data-width="739" data-height="391" src="https://cdn-images-1.medium.com/max/800/0*hu_bY4iSNNPWBpS1."></div></figure><p name="8130" id="8130" class="graf graf--p graf-after--figure">As you can see, Alice has 5i, which she gives to <em class="markup--em markup--p-em">both</em> Charlie and Bob. This is clearly a problem: we cannot treat both these transactions as valid. Using Tangle terminology, we cannot have a future transaction approving both of them, since it will end up with a negative balance in Alice’s account.</p><p name="268c" id="268c" class="graf graf--p graf-after--p">We have learned that using the weighted random walk algorithm, eventually one of the branches will become much larger. Thus a <em class="markup--em markup--p-em">consensus</em> is formed around which transaction is valid. From the perspective of Bob or Charlie, however, there is a problem: how do they know if they <em class="markup--em markup--p-em">really</em> got the money from Alice?</p><p name="2ce7" id="2ce7" class="graf graf--p graf-after--p">Imagine Bob and Charlie are dinosaur dealers, and Alice purchased a pet T-Rex from each of them. If they both send her the T-Rex immediately after seeing her transaction in the Tangle, eventually one of them will discover he has not been paid. How can they know when it is safe to ship the lizard?</p><p name="7375" id="7375" class="graf graf--p graf-after--p">This is a serious problem, and in fact, Bitcoin was the first technology to successfully deal with it, back in 2009. To show how the Tangle solves it, we introduce a concept called <em class="markup--em markup--p-em">confirmation confidence</em>. This confidence is a measure of a transaction’s level of acceptance by the rest of the tangle.</p><p name="adec" id="adec" class="graf graf--p graf-after--p">The confirmation confidence of a transaction is computed as follows:</p><ol class="postList"><li name="5997" id="5997" class="graf graf--li graf-after--p">Run the tip selection algorithm 100 times.</li><li name="fd37" id="fd37" class="graf graf--li graf-after--li">Count how many of those 100 tips approve our transaction, and call it A.</li><li name="68eb" id="68eb" class="graf graf--li graf-after--li">The confirmation confidence of our transaction is “A percent”.</li></ol><p name="557f" id="557f" class="graf graf--p graf-after--li">In other words, the confidence of a transaction is the percentage of tips which approve it. Not all tips are considered equally; more likely tips are given more importance. To illustrate this point, let’s add confirmation confidence to <a href="https://public-krwdbaytsx.now.sh" data-href="https://public-krwdbaytsx.now.sh" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">the simulation</strong></a>. Transactions with a confidence of over 95% are shown with a thick border around them.</p><figure name="86a2" id="86a2" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 341px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 48.699999999999996%;"></div><a href="https://public-krwdbaytsx.now.sh/" data-href="https://public-krwdbaytsx.now.sh/" class="graf-imageAnchor" data-action="image-link" data-action-observe-only="true"rel="noopener"target="_blank"><img class="graf-image" data-image-id="0*uhiAGN6uJ6a_pB1F." data-width="1283" data-height="625" src="https://cdn-images-1.medium.com/max/800/0*uhiAGN6uJ6a_pB1F."></a></div><figcaption class="imageCaption">Solving double-spending using Confirmation confidence</figcaption></figure><p name="d754" id="d754" class="graf graf--p graf-after--figure">In the tangle above, transaction 9 is approved by two out of the four tips. If we were using uniform random tip selection, it would have a confidence of exactly 50%. However, the tips that approve it are apparently more likely than the tips that do not, which raises the confidence a bit.</p><p name="ffd2" id="ffd2" class="graf graf--p graf-after--p">Now it is clear how Bob and Charlie can tell when it is safe to send their T-Rex to Alice. Once Alice’s transaction reaches some very high confidence threshold, say 95%, it is very unlikely that it will be pushed out of the consensus. We should be careful and say <em class="markup--em markup--p-em">very unlikely</em>, rather than impossible; if Alice wants to cheat, and has enough computational power, she can try to double-spend.</p><p name="885b" id="885b" class="graf graf--p graf-after--p">To do that, she will issue a transaction paying Charlie, instead of Bob. She will have to approve two <em class="markup--em markup--p-em">old</em> transactions with it, which do not reference her payment to Charlie. She will then start issuing as many transactions as she can, trying to raise the cumulative weight of her new branch. If she has enough computational power, she can cause the entire IOTA network to believe her and follow her new branch, thus re-writing history and successfully double-spending. If we look at the confidence level of her transaction to Bob, we will see it declining from 95% to eventually zero.</p><p name="5df8" id="5df8" class="graf graf--p graf-after--p">This attack is illustrated in the tangle below, with time going downwards:</p><figure name="f574" id="f574" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 875px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 125%;"></div><img class="graf-image" data-image-id="1*zf8LxIx88dZTj2YIHl9T0w.png" data-width="819" data-height="1024" src="https://cdn-images-1.medium.com/max/800/1*zf8LxIx88dZTj2YIHl9T0w.png"></div><figcaption class="imageCaption">A double-spend attack</figcaption></figure><p name="ed92" id="ed92" class="graf graf--p graf-after--figure">This scenario is only a risk if Alice can send more transactions than everyone else combined, or close to it. While not a major risk in a mature and active network, it is a real problem for today’s IOTA. There are not enough transactions going through the system for it to be safe from a concentrated double-spend attack.</p><p name="4173" id="4173" class="graf graf--p graf-after--p">Since IOTA was built for scaling we employ a voluntary and temporary different consensus mechanism for security reasons: the coordinator. Every two minutes, a <em class="markup--em markup--p-em">milestone</em> transaction is issued by the IOTA Foundation, and all transactions approved by it are considered to have a confirmation confidence of 100%, immediately. Using the coordinator, Alice’s second transaction will never have been approved in the first place. This acts as a protective mechanism while the IOTA network keeps growing toward the necessary activity from adoption needed to keep the network secure in a 100% decentralized manner, where the full Tangle distributed consensus algorithm kicks in. At that point the IOTA Foundation will shut down the Coordinator and let the Tangle evolve entirely on its own. This will happen in iterative phases. When the network is mature enough to get rid of the Coordinator the network will also instantly become orders of magnitude more efficient.</p><h3 name="0872" id="0872" class="graf graf--h3 graf-after--p">How is it Different from Blockchains?</h3><p name="cbb5" id="cbb5" class="graf graf--p graf-after--h3 graf--trailing">The way DAGs are different from Blockchains is that it changes the inherent structure of the way we store the transactions. This change, however small it may seem, changes the way we see the things happening in the network. It makes the overall system far more robust than a blockchain. But there is always a catch. This increase in scalablity comes with poorer security, more probability to Centralization and inability to inherently support smart contracts. We will discuss more about Blockchains vs DAGs in the next post. Stay Tuned!</p></div></div></section><section name="188d" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="aca5" id="aca5" class="graf graf--p graf--leading">Thanks for reading;)</p><figure name="e1ef" id="e1ef" class="graf graf--figure graf--layoutOutsetLeft graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 370px; max-height: 370px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 100%;"></div><img class="graf-image" data-image-id="1*PLw22EAlfu-TQhvLa6r4Yg.jpeg" data-width="370" data-height="370" src="https://cdn-images-1.medium.com/max/600/1*PLw22EAlfu-TQhvLa6r4Yg.jpeg"></div></figure><p name="ee7d" id="ee7d" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">About the Author</strong></p><p name="3cad" id="3cad" class="graf graf--p graf-after--p"><a href="http://vaibhavsaini.com/" data-href="http://vaibhavsaini.com/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Vaibhav Saini</a> is a Co-Founder of <a href="http://towardsblockchain.com" data-href="http://towardsblockchain.com" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">TowardsBlockchain</em></strong></a><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">, </em></strong><em class="markup--em markup--p-em">an MIT Cambridge Innovation Center incubated startup.</em></p><p name="e0c8" id="e0c8" class="graf graf--p graf-after--p">He works as Senior blockchain developer and has worked on several blockchain platforms including Ethereum, Quorum, EOS, Nano, Hashgraph, IOTA etc.</p><p name="b36c" id="b36c" class="graf graf--p graf-after--p">He is currently a sophomore at <a href="http://www.iitd.ac.in/" data-href="http://www.iitd.ac.in/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">IIT Delhi</a>.</p><h4 name="dc58" id="dc58" class="graf graf--h4 graf-after--p">Learned something? Press and hold the 👏 to say “thanks!” and help others find this article.</h4><p name="abe6" id="abe6" class="graf graf--p graf-after--h4"><em class="markup--em markup--p-em">Hold down the clap button if you liked the content! It helps me gain exposure .</em></p><p name="3a73" id="3a73" class="graf graf--p graf-after--p">Want to learn more? Checkout my previous articles.</p><div name="1647" id="1647" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://hackernoon.com/consensuspedia-an-encyclopedia-of-29-consensus-algorithms-e9c4b4b7d08f" data-href="https://hackernoon.com/consensuspedia-an-encyclopedia-of-29-consensus-algorithms-e9c4b4b7d08f" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://hackernoon.com/consensuspedia-an-encyclopedia-of-29-consensus-algorithms-e9c4b4b7d08f"><strong class="markup--strong markup--mixtapeEmbed-strong">ConsensusPedia: An Encyclopedia of 30 Consensus Algorithms</strong><br><em class="markup--em markup--mixtapeEmbed-em">A complete list of all consensus algorithms.</em>hackernoon.com</a><a href="https://hackernoon.com/consensuspedia-an-encyclopedia-of-29-consensus-algorithms-e9c4b4b7d08f" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="03bbca255c9ab55c0112e7879627edb3" data-thumbnail-img-id="0*y462aeJ4wg8HHYSs" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*y462aeJ4wg8HHYSs);"></a></div><div name="c778" id="c778" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed"><a href="https://hackernoon.com/getting-deep-into-ethereum-how-data-is-stored-in-ethereum-e3f669d96033" data-href="https://hackernoon.com/getting-deep-into-ethereum-how-data-is-stored-in-ethereum-e3f669d96033" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://hackernoon.com/getting-deep-into-ethereum-how-data-is-stored-in-ethereum-e3f669d96033"><strong class="markup--strong markup--mixtapeEmbed-strong">Getting Deep Into Ethereum: How Data Is Stored In Ethereum?</strong><br><em class="markup--em markup--mixtapeEmbed-em">In this post we will see how states and transactions are stored in Ethereum and how it is different from Bitcoin.</em>hackernoon.com</a><a href="https://hackernoon.com/getting-deep-into-ethereum-how-data-is-stored-in-ethereum-e3f669d96033" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="f1c6e01fc190914edbec14aa93c3ae61" data-thumbnail-img-id="1*f0vOn0lRgrY5NjFlbUMBFg.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*f0vOn0lRgrY5NjFlbUMBFg.jpeg);"></a></div><div name="4e25" id="4e25" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed"><a href="https://hackernoon.com/contractpedia-an-encyclopedia-of-40-smart-contract-platforms-4867f66da1e5" data-href="https://hackernoon.com/contractpedia-an-encyclopedia-of-40-smart-contract-platforms-4867f66da1e5" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://hackernoon.com/contractpedia-an-encyclopedia-of-40-smart-contract-platforms-4867f66da1e5"><strong class="markup--strong markup--mixtapeEmbed-strong">ContractPedia: An Encyclopedia of 40 Smart Contract Platforms</strong><br><em class="markup--em markup--mixtapeEmbed-em">A Complete List of all Smart Contract supportive Platforms</em>hackernoon.com</a><a href="https://hackernoon.com/contractpedia-an-encyclopedia-of-40-smart-contract-platforms-4867f66da1e5" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="a949ea9028a00c3bb62dfc3f160efc92" data-thumbnail-img-id="0*zDyDSLiGCSPQHEMq.jpg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*zDyDSLiGCSPQHEMq.jpg);"></a></div><div name="921b" id="921b" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed"><a href="https://hackernoon.com/difference-between-sidechains-and-state-channels-2f5dfbd10707" data-href="https://hackernoon.com/difference-between-sidechains-and-state-channels-2f5dfbd10707" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://hackernoon.com/difference-between-sidechains-and-state-channels-2f5dfbd10707"><strong class="markup--strong markup--mixtapeEmbed-strong">Difference between SideChains and State Channels</strong><br><em class="markup--em markup--mixtapeEmbed-em">A complete comparison of the two scaling methods.</em>hackernoon.com</a><a href="https://hackernoon.com/difference-between-sidechains-and-state-channels-2f5dfbd10707" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="096410b77bc232079dc957910f44555f" data-thumbnail-img-id="1*UmKkLx0_zCrwX1etzE-TRg.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*UmKkLx0_zCrwX1etzE-TRg.jpeg);"></a></div><p name="d8ac" id="d8ac" class="graf graf--p graf-after--mixtapeEmbed graf--trailing"><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">Clap 50 times and follow me on Twitter: </em></strong><a href="https://twitter.com/vasa_develop" data-href="https://twitter.com/vasa_develop" class="markup--anchor markup--p-anchor" rel="noopener nofollow nofollow noopener nofollow noopener noopener noopener noopener noopener noopener noopener noopener" target="_blank"><strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">@vasa_develop</em></strong></a></p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@vaibhavsaini_67863" class="p-author h-card">vasa</a> on <a href="https://medium.com/p/7fc0dd7f39a2"><time class="dt-published" datetime="2018-08-20T10:46:01.825Z">August 20, 2018</time></a>.</p><p><a href="https://medium.com/@vaibhavsaini_67863/a-beginners-ultimate-guide-to-dags-7fc0dd7f39a2" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on July 19, 2019.</p></footer></article></body></html>